:sourcesdir: ../../../source

[[run_actions]]
=== Запуск отчётов из экранов

Отчёты можно запускать из произвольных экранов системы, используя специальные действия и связанные с ними кнопки или элементы контекстного меню компонентов. При этом кроме доступности отчёта в соответствии с ролью пользователя проверяется также его <<permissions,принадлежность>> данному экрану.

Рассмотрим типы действий и примеры их использования.

[[run_report_action]]
* `com.haulmont.reports.gui.actions.list.RunReportAction` – {main_man_url}/standard_actions.html[стандартное действие], отображающее список всех доступных отчётов. Действие определяется для компонента `Button` или для компонента-списка (`Table`, `DataGrid` и так далее).
+
Пример декларативного объявления действия для `GroupTable`:
+
[source, xml]
----
include::{sourcesdir}/run_actions_example1.xml[]
----
<1> - в атрибуте `type` задаётся тип действия `runReport`, предоставляемый фреймворком.
+
Пример программного создания действия для кнопки, объявленной в XML-дескрипторе экрана:
+
[source, java]
----
include::{sourcesdir}/run_actions_example2.java[]
----
+
При выполнении действия `RunReportAction` откроется модальное окно **Run Reports**, в котором будут отображаться отчёты, доступные для текущего экрана. При выборе пользователем отчёта из списка отображается форма ввода параметров (если они заданы), и отчёт запускается на исполнение.

[[list_print_form_action]]
* `com.haulmont.reports.gui.actions.list.ListPrintFormAction` – {main_man_url}/standard_actions.html[стандартное действие] для печати отчётов для экземпляров сущностей, определённое для компонента-списка (`Table`, `DataGrid` и так далее).
+
Действие отбирает только те отчёты, которые имеют внешний параметр типа *Entity* или *List of entities*, и тип сущности параметра совпадает с типом сущности, отображаемой компонентом-списком. Если в результате отбора доступен только один отчёт, он сразу запускается на исполнение. Если доступно несколько отчётов, их список предлагается пользователю.
+
--
В отчёт передается значение внешнего параметра по следующим правилам:

** Если параметр типа *List of entities*, то в него передаются выбранные в данный момент в компоненте-списке экземпляры сущности.

** Если параметр типа *Entity*, и в компоненте-списке выбран один экземпляр (выделена одна строка), то в отчёт передается этот экземпляр.

** Если параметр типа *Entity*, а в компоненте-списке выделено несколько строк, то отчёт исполняется несколько раз по числу выбранных экземпляров. После выполнения пользователю возвращается один ZIP архив, в котором находятся все сформированные отчёты.
--
+
Пример декларативного объявления действия для `GroupTable`:
+
[source, xml]
----
include::{sourcesdir}/run_actions_example5.xml[]
----
<1> - в атрибуте `type` задаётся тип действия `listPrintForm`, предоставляемый фреймворком.
+
Пример программного создания действия для кнопки, объявленной в XML-дескрипторе экрана:
+
[source, java]
----
include::{sourcesdir}/run_actions_example6.java[]
----
+
Если в компоненте-списке не было выбрано ни одной сущности, то при выполнении действия `ListPrintFormAction` появится окно подтверждения:
+
.Окно подтверждения
image::run_actions_listPrint_confirmation.png[align="center"]
+
После этого откроется модальное окно **Run reports**, в котором отображаются отчёты, относящиеся к текущему экрану. С этого экрана пользователь может запустить некоторый отчёт для выбранной сущности.

[[editor_print_form_action]]
* `com.haulmont.reports.gui.actions.EditorPrintFormAction` – действие, связанное с экраном редактирования экземпляра сущности. Действие отбирает только те отчёты, которые имеют внешний параметр типа *Entity* или *List of entities*, и тип сущности параметра совпадает с типом редактируемой сущности. Если в результате отбора доступен только один отчёт, он сразу запускается на выполнение. Если доступно несколько отчётов, их список предлагается пользователю.
+
В отчёт передается значение внешнего параметра – экземпляр редактируемой сущности. Если тип параметра – *List of entities*, то передается список из одного элемента.
+
Пример использования с кнопкой, размещенной рядом со стандартными кнопками *OK* и *Cancel*:
+
--
** XML-дескриптор
+
[source, xml]
----
include::{sourcesdir}/run_actions_example7.xml[]
----

** Контроллер
+
[source, java]
----
include::{sourcesdir}/run_actions_example8.java[]
----
--

[[execution_history_action]]
* `com.haulmont.reports.gui.actions.list.ExecutionHistoryAction` – {main_man_url}/standard_actions.html[стандартное действие] для отображения <<execution_history,истории исполнения>> отчёта. Действие определяется для компонента `Button` или для компонента-списка (`Table`, `DataGrid` и так далее).
+
Для просмотра истории задайте свойству <<reporting.executionHistory.enabled,reporting.executionHistory.enabled>> значение `true` в экране **Administration > Application Properties**.
+
Пример декларативного объявления действия для `GroupTable`:
+
[source, xml]
----
include::{sourcesdir}/run_actions_example3.xml[]
----
<1> - в атрибуте `type` задаётся тип действия `executionHistory`, предоставляемый фреймворком.
+
Пример программного создания действия для кнопки, объявленной в XML-дескрипторе экрана:
+
[source, java]
----
include::{sourcesdir}/run_actions_example4.java[]
----
+
При выполнении действия `ExecutionHistoryAction` откроется модальное окно **Execution history**, в котором будут отображаться отчёты, доступные для текущего экрана. При выборе пользователем отчёта из списка отображается экран просмотра истории исполнения выбранного отчёта. Если в списке отчётов ни один отчёт не был выбран, то в экране просмотра будет отображена история исполнения всех отчётов, связанных с экраном.

