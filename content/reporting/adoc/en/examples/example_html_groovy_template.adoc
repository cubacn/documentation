:sourcesdir: ../../../source

[[example_html_groovy_template]]
=== HTML Report with Groovy template engine

The example is based on the sample *Library* application, which source code is available on https://github.com/cuba-platform/sample-library-cuba7[GitHub]. Let’s create a report that displays the list of book publications for the selected city. The output format is HTML.

. Create a report with JPQL dataset:
+
.Report data structure
image::html_groovy_template_structure.png[align="center"]

+
The `BookPublications` band outputs the list of book's publications by running the following JPQL query:
+
[source, sql]
.BookPublications dataset
----
include::{sourcesdir}/bookPublications_example_groovy_html.jpql[]
----
+
This query uses the external report parameter – `city`. The parameter has the *Entity* type; however, in JPQL queries you can compare it directly with entity identifier fields; the conversion will be done automatically.

. Describe the report parameter:
+
The *Parameters and Formats* tab contains one declared report external parameter – `City`:
+
.The report parameter
image::html_groovy_template_parameter.png[align="center"]
+
When running the report, the user will have to enter this parameter. The city selection will be performed via the `library$Town.browse` screen, available in the application.

. Create a report template
+
The *Templates* tab contains a single defined HTML template, generated by default with FreeMarker tags.
+
Create the new HTML file with the following content:
+
[source, html]
.PublicationsTemplate
----
include::{sourcesdir}/PublicationsTemplate.html[]
----
+
The value of the input parameter is used to generate the report title: `${Root.fields.city.name}`.
+
The variable `bookPublications` is defined below:
+
[source, groovy]
----
<% def bookPublications = Root.bands.BookPublications.fields %>
----
+
This variable is used in the table's body to display the report fields.
+
[source, groovy]
----
<% bookPublications.title.eachWithIndex{elem, index -> out << "<tr><td> ${bookPublications.book[index]} </td><td> ${bookPublications.publisher[index]} </td></tr>"}%>
----
+
Upload the new template to the application, select HTML output type, select *Groovy template* in the *Template type* radiobutton and make it default:
+
.Report template editor
image::publicationsTemplate_editor.png[align="center"]

Run the report to make sure it works:

.Report result
image::publications_report.png[align="center"]
