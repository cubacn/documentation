:sourcesdir: ../../../../source

[[app_components_sample]]
==== Пример создания и использования компонента

В данном разделе рассматривается пример создания и использования в проекте компонента приложения. Компонент будет предоставлять функциональность "Customer Management" и содержать сущность `Customer` и соответствующие экраны UI. Приложение будет использовать сущность `Customer` из компонента в качестве ссылки в собственной сущности `Order`.

image::app_components_sample.png[align="center"]

Создание компонента Customer Management::

. Создайте новый проект в Studio и укажите следующие значения в окне *New project*:

* *Project name* – `customers`

* *Project namespace* – `cust`

* *Root package* – `com.company.customers`

. Откройте экран *Project Properties* и установите значение поля *Module prefix* в `cust`.

. Создайте сущность `Customer` с атрибутом `name`. Укажите <<namePattern_annotation,имя экземпляра>> сущности в поле *Instance name*.
+
[WARNING]
====
Если компонент содержит персистентные классы, аннотированные `@MappedSuperclass`, убедитесь, что в этом же проекте есть их наследники, являющиеся сущностями (т.е. аннотированные `@Entity`). В противном случае байткод таких базовых классов не будет необходимым образом модифицирован, и они не будут правильно работать в приложениях, использующих компонент.
====

. Сгенерируйте скрипты БД и создайте стандартные экраны для сущности `Customer`: `cust_Customer.browse` и `cust_Customer.edit`.
. Перейдите в дизайнер меню и переименуйте пункт меню `application-cust` в `customerManagement`. Затем в файле `messages.properties` главного пакета сообщений укажите новый заголовок для пункта меню `customerManagement`.
. Сгенерируйте <<app-component.xml,описатель компонента>> – файл `app-component.xml`, выбрав пункт *CUBA > Advanced > App Component Descriptor* в главном меню Studio.
. Проверьте функциональность Customer Management:

* Выберите пункт меню *CUBA > Create Database*.
* Запустите приложение: кликните на кнопку "debug" рядом с выбранной конфигурацией `CUBA Application` в главной панели инструментов.
* Откройте `++http://localhost:8080/cust++` в веб-браузере.

. Установите компонент приложения в локальный Maven-репозиторий, выбрав пункт главного меню *CUBA > Advanced > Install App Component*.

Создание приложения Sales::

. Создайте новый проект в Studio и укажите следующие значения в окне *New project*:

* *Project name* – `sales`

* *Project namespace* – `sales`

* *Root package* – `com.company.sales`

. Откройте экран настроек *Project Properties* и в разделе *Repositories* добавьте локальный репозиторий Maven в список используемых репозиториев.

. На панели *App components* нажмите на кнопку добавления *Custom components*. В диалоге *Custom application component* введите Maven-координаты компонента Customer Management, например, `com.company.customers:cust-global:0.1-SNAPSHOT`. Сохраните страницу свойств проекта нажатием *OK*. Когда Studio предложит внести изменения в скрипты Gradle, согласитесь.

. Создайте сущность `Order` с атрибутами `date` и `amount`. Добавьте атрибут `customer` в виде many-to-one ассоциации с сущностью `Customer` – она должна быть доступна в выпадающем списке *Type*.

. Сгенерируйте скрипты БД и создайте стандартные экраны для сущности `Order`. При создании экранов создайте представление `order-with-customer-view`, включающее атрибут `customer`, и используйте его в экранах.

. Проверьте функциональность приложения:

* Выберите пункт меню *CUBA > Create Database*.
* Запустите приложение: кликните на кнопку "debug" рядом с выбранной конфигурацией `CUBA Application` в главной панели инструментов.
* Откройте `++http://localhost:8080/app++` в веб-браузере. Приложение должно содержать два пункта меню верхнего уровня: *Customer Management* и *Application*.

Модификация компонента Customer Management::

Предположим, что необходимо изменить функциональность компонента (добавить атрибут в сущность `Customer`) и пересобрать приложение для внесения этих изменений.

. Откройте проект `customers` в Studio.

. Откройте сущность `Customer` на редактирование и добавьте атрибут `address`. Включите этот атрибут в экраны браузера и редактора.

. Сгенерируйте скрипты БД – будет создан новый скрипт обновления с изменением таблицы. Сохраните скрипты.

. Проверьте изменения в компоненте:
* Выберите пункт меню *CUBA > Update Database*.
* Запустите приложение: кликните на кнопку "debug" рядом с выбранной конфигурацией `CUBA Application` в главной панели инструментов.
* Откройте `++http://localhost:8080/cust++` в веб-браузере.

. Переустановите компонент в локальный Maven-репозиторий, выбрав пункт меню *CUBA > Advanced > Install App Component*.

. Закройте проект `sales` в Studio (если он открыт) и откройте его снова. Это необходимо для того, чтобы Studio загрузила новые исходники компонента.

. Выберите пункты меню *CUBA > Build Tasks > Clean*, затем *CUBA > Build Tasks > Assemble*.

. Выберите пункт меню *CUBA > Update Database* – будет выполнен скрипт обновления из компонента Customer Management.

. Запустите приложение: кликните на кнопку "debug" рядом с выбранной конфигурацией `CUBA Application` в главной панели инструментов.

. Откройте `++http://localhost:8080/app++` в веб-браузере – приложение теперь содержит сущность `Customer` и соответствующие экраны с атрибутом `address`.

